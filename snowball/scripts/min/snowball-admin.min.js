!function(l){function t(){l("#publish, #save-post").on("click",function(){"publish"==l(this).attr("id")?(snowball.status="publish",v.push({action:"save",type:"publish"})):(snowball.status="draft",v.push({action:"save",type:"draft"})),m=!1}),l("#title").on("input",p(function(){snowball.title=l(this).val(),l(".snowball-block").each(function(){l(this).trigger("render")})},250)),l("#snowball-toolbar").css("width",l("#snowball-toolbar").parent().width()).fixedsticky(),l("#snowball-toolbar .block-button").on("click",function(){var t=l(this).data("type");e(t),w(),v.push({action:"add",type:t})}),l("#snowball-toolbar .tag").on("click",function(){var t=l(this).attr("data-tag");l(".tag.active").removeClass("active"),l(this).addClass("active"),"all"===t?l("#snowball-toolbar .buttons .button").removeClass("hidden"):l("#snowball-toolbar .buttons .button").addClass("hidden").filter("."+t).removeClass("hidden")}),l("#snowball-toolbar .settings .button").on("click",function(){var t=l(this).attr("data-click");l(t).click()}),l("#snowball-toolbar .menu-toggle").on("click",function(){var t=l(this).next(".dialog"),o=t.find(".CodeMirror");if(t.addClass("modal"),l("body").toggleClass("modal"),0===o.length&&t.hasClass("settings-dropdown")){var e=t.find("textarea").get(0);o=CodeMirror.fromTextArea(e,{mode:{name:"htmlmixed",htmlMode:!0},lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,theme:"monokai"})}}),l("#snowball-toolbar .menu .close").on("click",function(){var t=l(this).closest(".dialog"),o=t.find(".CodeMirror")[0].CodeMirror.getValue();o&&v.push({action:"code",type:"head",data:o}),t.removeClass("modal"),l("body").removeClass("modal")}),l("#snowball-settings .toggle").on("click",function(){l("#snowball-settings ul").toggle()}),l("#snowball-main").on("render",".snowball-block",function(){var t=l(this);n(t)}).on("mousedown",".snowball-block",function(){l("#snowball-main").height(l("#snowball-main").height())}).on("mouseup",".snowball-block",function(){l("#snowball-main").height("auto")}).on("input change paste",".snowball-tinker input, .snowball-tinker textarea, .snowball-tinker select",p(function(){var t=l(this).closest(".snowball-block");t.trigger("render"),b(t),w()},250)).on("click",".snowball-delete",function(){var t=l(this).closest(".snowball-block");t.data("type");u(t)}).on("click",".snowball-copy",function(){var t=l(this).closest(".snowball-block"),o=t.data("type");d(t),w(),v.push({action:"copy",type:o})}).on("click",".snowball-zoom-toggle",function(){var t=l(this).closest(".snowball-block"),o=t.data("type");if(t.find(".snowball-code, .snowball-copy, .snowball-delete, .snowball-top, .snowball-bottom").toggle(),t.toggleClass("modal"),l("body").toggleClass("modal"),s(t),!t.hasClass("modal")){var e=t.find(".snowball-css .CodeMirror")[0].CodeMirror,n=c(e);v.push({action:"code",type:o,data:n})}t.find(".CodeMirror").each(function(l,t){t.CodeMirror.refresh()})}).on("click",".snowball-top",function(){var t=l(this).closest(".snowball-block");t.index()>0&&(t.parent().prepend(t),w())}).on("click",".snowball-bottom",function(){var t=l(this).closest(".snowball-block");t.index()<l(".snowball-block").length-1&&(t.parent().append(t),w())}).on("mouseover",".snowball-zoom-toggle",function(){var t=l(this).closest(".snowball-block");0===t.find(".snowball-code .CodeMirror").length&&i(t)}).on("change",".handsontable",function(){w()}).sortable({axis:"y",cancel:".snowball-block.modal, .snowball-title-button, button, textarea, input, select, .handsontable .wtHider, .CodeMirror, .button, .toggle-buttons",change:function(){w()},containment:"#snowball-main",cursor:"move",tolerance:"pointer"}),l("body").on("click","#modal-bg",function(){l(".snowball-block.modal .snowball-zoom-toggle, .settings-dropdown.modal .close").click(),l(".modal").removeClass("modal")}).on("keydown",function(t){27===t.keyCode&&(l(".snowball-block.modal .snowball-zoom-toggle, .settings-dropdown.modal .close").click(),l(".modal").removeClass("modal"))}),l(window).resize(p(function(){s(),l(".fixedsticky").fixedsticky("destroy").fixedsticky()},250)).resize(function(){var t=l(".fixedsticky");t.css("width",t.parent().width())}).on("load",function(){l(".fixedsticky").fixedsticky("destroy").fixedsticky()}).on("beforeunload",function(l){if(f(),m)return"You may have unsaved changes."}),l("#collapse-menu").click(function(){var t=l(".fixedsticky");t.css("width",t.parent().width()),s()}),l(".hndle, #adv-settings input, .columns-prefs input").on("click",function(){var t=l(".fixedsticky");t.css("width",t.parent().width()),t.fixedsticky("destroy").fixedsticky()}),l("#show-settings-link").on("click",function(){setTimeout(function(){l(".fixedsticky").fixedsticky("destroy").fixedsticky()},200)})}function o(){for(var l in snowball.savedblocks){var t=snowball.savedblocks[l],o=t.blockType.toLowerCase();delete t.blockType,delete t.orderNumber,e(o,t)}}function e(t,o,e){var a=snowball.blocks[t],i=snowball.names[t],r=l("<div class='snowball-block'><div class='snowball-gui'><div class='snowball-tinker'><div><div class='snowball-title'></div><div class='snowball-title-button-group'><div class='snowball-title-button snowball-copy' title='Copy block'><i class='fa fa-files-o'></i></div><div class='snowball-title-button snowball-delete' title='Delete block'>&times;</div></div><div class='snowball-title-button-group'><div class='snowball-title-button snowball-top' title='Move block to top'><i class='fa fa-angle-double-up'></i></div><div class='snowball-title-button snowball-bottom' title='Move block to bottom'><i class='fa fa-angle-double-down'></i></div></div><div class='snowball-title-button-group'><div class='snowball-title-button snowball-zoom-toggle' title='Edit code'><i class='fa fa-code'></i></div></div></div></div><iframe class='snowball-preview'></iframe></div><div class='snowball-code'><div class='snowball-html snowball-editor'><div class='snowball-code-title'>HTML</div><textarea class='snowball-editor-box' data-mode='xml'></textarea></div><div class='snowball-css snowball-editor'><div class='snowball-code-title'>CSS</div><textarea class='snowball-editor-box' data-mode='css'></textarea></div></div></div>");if(r.addClass("snowball-block-"+t).attr("data-type",t).attr("data-name",i).find(".snowball-title").text(i).end().find(".snowball-tinker").append(a).end(),o)for(var c in o){if(o.hasOwnProperty(c)){var d="[data-target='"+c+"']",b=r.find(d),u=o[c];b&&(b.is(":radio")?b.filter("[value='"+u+"']").prop("checked",!0):b.is(":checkbox")?b.prop("checked","true"==u||u===!0):b.val(u))}o.customCss&&r.find("textarea[data-mode='css']").html(o.customCss)}else{var w={blockType:t};snowball.savedblocks.push(w)}r.find(".snowball-preview").load(function(){n(r)}).end().find(".wp-color-picker").wpColorPicker({change:p(function(t){l(this).trigger("change").attr("value",l(this).val())},250)}),"undefined"==typeof e?r.appendTo("#snowball-main"):r.insertAfter(l(".snowball-block").eq(e)),s(r),r.trigger("open")}function n(t){var o=t.data("type"),e=t.find(".snowball-preview").contents(),n=snowball.templates[o],i="input[type='text'][data-target], input[type='email'][data-target], input[type='range'][data-target], input[type='hidden'][data-target], input[type='radio'][data-target]:checked, input[type='checkbox'][data-target]:checked, textarea[data-target], select[data-target]",r=t.find(i);r.each(function(t,e){var a=l(this).data("target"),s=l(this).val();"text"===o&&l(this).is("textarea")&&(s=s.replace(/\n([ \t]*\n)+/g,"</p><p>").replace(/\n/g,"<br />").replace(/<\/p><p>/g,"</p>\n\t<p>"));var i=new RegExp("{{"+a+"}}","g");n=n.replace(i,s)}),n=n.replace(/{{.+}}/g,""),n=n.replace(/\[author\]/g,snowball.author).replace(/\[blogname\]/g,snowball.blogname).replace(/\[blogurl\]/g,snowball.blogurl).replace(/\[date\]/g,snowball.date).replace(/\[url\]/g,snowball.url),snowball.title&&(n=n.replace(/\[title\]/g,snowball.title));var c=l(n),d=c.find("script").detach();e.find("body").empty().append(c),a(d,t),t.width()&&s(t),t.trigger("rendered")}function a(t,o){function e(l){var t=s.get(0).contentDocument.createElement("script");t.src=h[l],l<h.length-1?t.onload=function(){e(l+1)}:t.onload=function(){n(0)},r[0].appendChild(t)}function n(l){if(l<t.length){var o=t.eq(l).attr("src"),e=s.get(0).contentDocument.createElement("script");o?(e.src=o,e.onload=function(){n(l+1)}):e.innerHTML=t.eq(l).html(),d.find(".snowball-block").get(0).appendChild(e)}}var a,s=o.find(".snowball-preview"),i=s.contents(),r=i.find("head"),d=i.find("body"),b=o.find(".snowball-code .CodeMirror"),u="",w=snowball.pluginsUrl,p=snowball.includesUrl;if(b.length){var f=b[1].CodeMirror;a=c(f)}else a=o.find("textarea[data-mode='css']").html();if(a){var m=l("<style></style>").attr({"data-type":"custom",scoped:"scoped"});m.html(a),d.find(".snowball-block").append(m)}var v=[w+"/lib/d3-geomap/css/d3.geomap.css",w+"/lib/font-awesome/css/font-awesome.min.css",w+"/styles/min/snowball.min.css",w+"/styles/min/snowball-theme.min.css",w+"/styles/min/snowball-preview.min.css"],h=[p+"js/jquery/jquery.js","https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js","https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js",w+"/lib/d3-geomap/vendor/d3.geomap.dependencies.min.js",w+"/lib/d3-geomap/js/d3.geomap.min.js",w+"/scripts/min/snowball-preview.min.js",w+"/scripts/min/templates.min.js"];v.forEach(function(l){var t="<link rel='stylesheet' href='"+l+"'>\n";u+=t}),r.is(":empty")?(r.html("<meta charset='utf-8'>"),r.append(u),r.append(l("#snowball-custom-code").val()),e(0)):n(0)}function s(t){var o,e,n;t?(o=t.width()/2,e=o<800?o/800:1,n="scale("+e+")",t.find(".snowball-preview").contents().find("html").css({"-webkit-transform":n,transform:n})):l(".snowball-preview").each(function(){o=l(this).closest(".snowball-block").width()/2,e=o<800?o/800:1,n="scale("+e+")",l(this).contents().find("html").css({"-webkit-transform":n,transform:n})})}function i(t){var o=t.find(".snowball-preview").contents().find("body"),e=t.find(".snowball-editor-box");e.each(function(t,e){var a=l(e).attr("data-mode"),s="xml"===a,i=CodeMirror.fromTextArea(e,{mode:{name:a,htmlMode:!0},readOnly:s,lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,theme:"monokai"});r(o,a,i),i.on("change",p(function(){var t=l(e).closest(".snowball-block");n(t),w()},250))})}function r(t,o,e,n){var a="",s=0;if("css"==o){t.find("style:not([data-type='custom'])").each(function(){a+=l(this).html()}),a?(a=a.replace(/^\n+|\n+$/g,""),a+="\n\n",s=a.split(/\r\n|\r|\n/).length-1):a="",n&&(a+=n);var i=c(e);i&&(a+=i)}else if("xml"===o){var r=t.clone();r.find("style").remove(),a=r.html().replace("\n\n</section>","\n</section>"),s=a.split(/\r\n|\r|\n/).length}var d=e.getCursor(),b=e.getScrollInfo().top,u={line:0,ch:0},w={line:s,ch:0},p={readOnly:!0,inclusiveLeft:!0};e.setValue(a),e.markText(u,w,p);for(var f=0;f<s;f++)e.addLineClass(f,"background","readonly");e.setCursor(d),e.scrollTo(null,b)}function c(l){var t=l.getAllMarks(),o=l.getValue();if(t.length){var e=t[0],n=e.lines.length;if(n<2)o=l.getValue();else{var a={line:n-1,ch:0},s={line:l.lastLine()+1,ch:0};o=l.getRange(a,s)}}return o}function d(l){var t=l.data("type"),o=parseBlock(l),n=l.index();o&&e(t,o,n)}function b(l){var t=l.find(".snowball-code .CodeMirror");if(t.length){var o=t[0].CodeMirror,e=t[1].CodeMirror,n=l.find(".snowball-preview").contents().find("body");r(n,"xml",o),r(n,"css",e)}}function u(l){var t=confirm("Are you sure you want to delete this block?");if(t){var o=l.data("type");l.trigger("close").remove(),w(),v.push({action:"delete",type:o})}}function w(){m=!0,l("#snowball-toolbar .settings .draft, #snowball-toolbar .settings .save").addClass("unsaved")}function p(l,t){var o=null;return function(){var e=this,n=arguments;clearTimeout(o),o=setTimeout(function(){l.apply(e,n)},t)}}function f(){var t,o=[],e=[],n=[],a=l(".settings-dropdown .CodeMirror");t=a.length>0?a[0].CodeMirror.getValue():l("#snowball-custom-code").val(),l(".snowball-block").each(function(){var t,a=l(this),s=a.data("type"),i=a.find(".snowball-css .CodeMirror");if(o.push(s),t=i.length>0?c(i[0].CodeMirror):a.find(".snowball-editor-box").val(),n.push({type:s,code:t}),"html"===s){var r=a.find(".snowball-tinker .CodeMirror")[0].CodeMirror.getValue();e.push(r)}}),Parse.initialize("FwVMmzHookZZ5j9F9ILc2E5MT5ufabuV7hCXKSeu","Q069j2TUEegDfQJXxxYp7OIZrgu7ySYcqmSU05pQ");var s=Parse.Object.extend("Blocks"),i=new s;i.set({blogname:snowball.blogname,blogurl:snowball.blogurl,url:snowball.url,postid:snowball.id,status:snowball.status,author:snowball.authorLogin,user:snowball.userLogin,article:o,size:o.length,actions:v,head:t,css:n,html:e}),i.save(),v=[]}var m=!1,v=[];snowball.status=0===l("#save-post").length?"publish":"draft",jQuery(document).ready(function(){0!==snowball.savedblocks.length&&"null"!==snowball.savedblocks?(l("#snowball_meta").removeClass("closed"),snowball.savedblocks=JSON.parse(snowball.savedblocks),o()):snowball.savedblocks=[],t()})}(jQuery);
//# sourceMappingURL=snowball-admin.min.js.map
